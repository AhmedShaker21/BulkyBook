@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Aircraft Organization System</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f4f6fb;
            font-family: "Segoe UI", sans-serif;
        }

        .sidebar {
            position: fixed;
            right: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: #0b3d5c;
            color: #fff;
            padding: 20px 15px;
            overflow-y: auto;
        }

            .sidebar .logo {
                font-size: 22px;
                font-weight: 700;
                margin-bottom: 25px;
                text-align: center;
            }

            .sidebar a {
                color: #e7eef3;
                text-decoration: none;
                display: block;
                padding: 10px 14px;
                margin-bottom: 6px;
                border-radius: 6px;
                transition: 0.3s;
                font-size: 15px;
            }

                .sidebar a:hover {
                    background: #145d88;
                }

        .sidebar-section-title {
            margin-top: 20px;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 600;
            opacity: .75;
        }

        .content {
            margin-right: 270px;
            padding: 25px;
        }

        footer {
            margin-right: 270px;
            padding: 12px;
            background: #0b3d5c;
            color: #fff;
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="logo">
            ✈ Aircraft Org. System
        </div>

        <div class="sidebar-section-title">الرئيسية</div>

        <a asp-area="Customer" asp-controller="Dashboard" asp-action="Index">
            <i class="bi bi-speedometer2"></i> Dashboard
        </a>


        @* صلاحيات رئيس مجلس الإدارة *@
        @if (User.IsInRole("Chairman"))
        {
            <div class="sidebar-section-title">الهيكل التنظيمي</div>

            <a asp-area="Admin" asp-controller="Sector" asp-action="Index">
                <i class="bi bi-diagram-3"></i> القطاعات
            </a>

            <a asp-area="Admin" asp-controller="Department" asp-action="Index">
                <i class="bi bi-building"></i> الإدارات
            </a>

            <a asp-area="Admin" asp-controller="User" asp-action="Index">
                <i class="bi bi-people"></i> المستخدمون
            </a>
        }

        <div class="sidebar-section-title">المذكرات</div>

        <a asp-area="Customer" asp-controller="Memo" asp-action="Create">
            <i class="bi bi-pencil-square"></i> إنشاء مذكرة
        </a>

        <a asp-area="Customer" asp-controller="Memo" asp-action="Inbox">
            <i class="bi bi-inbox-fill"></i> الوارد
        </a>

        <a asp-area="Customer" asp-controller="Memo" asp-action="Sent">
            <i class="bi bi-send-check"></i> الصادر
        </a>
        <a asp-area="Customer" asp-controller="Dashboard" asp-action="Index">
    <i class="bi bi-speedometer2"></i> Dashboard
</a>
        @inject BulkyBook.DataAcess.Data.ApplicationDbContext Db

        @{
            string? currentUserId = null;
            int unreadCount = 0;

            if (User.Identity.IsAuthenticated)
            {
                var claim = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier);
                if (claim != null)
                {
                    currentUserId = claim.Value;
                    unreadCount = Db.Notifications.Count(n => n.UserId == currentUserId && !n.IsRead);
                }
            }
        }

        <!-- داخل الـ sidebar -->
        @if (User.Identity.IsAuthenticated)
        {
            <a asp-area="Customer" asp-controller="Notifications" asp-action="Index">
                <i class="bi bi-bell-fill"></i>
                الإشعارات
                @if (unreadCount > 0)
                {
                    <span class="badge bg-danger">@unreadCount</span>
                }
            </a>
        }


        <div class="sidebar-section-title">الحساب</div>
        <partial name="_LoginPartial" />
    </div>

    <!-- CONTENT -->
    <div class="content">
        <partial name="_Notification" />
        @RenderBody()
    </div>

    <footer>
        © 2025 Aircraft Organization System - Developed by Ahmed Shaker
    </footer>

    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        @if (TempData["success"] != null)
        {
                <text>
                    Swal.fire({
                        toast: true,
                        icon: 'success',
                        title: '@TempData["success"]',
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    });
                </text>
        }

        @if (TempData["error"] != null)
        {
                <text>
                    Swal.fire({
                        toast: true,
                        icon: 'error',
                        title: '@TempData["error"]',
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    });
                </text>
        }
    </script>
    @await RenderSectionAsync("Scripts", required: false)

</body>
</html>
