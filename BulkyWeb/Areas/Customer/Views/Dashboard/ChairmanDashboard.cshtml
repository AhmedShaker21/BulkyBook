@model BulkyBook.Models.ViewModels.DashboardVM

<h2 class="mb-4">لوحة التحكم - رئيس مجلس الإدارة</h2>

<div class="row">

    <!-- Total Sectors -->
    <div class="col-md-3 mb-3">
        <div class="card shadow p-3 text-center" style="border-top:4px solid #003d66">
            <h6>القطاعات</h6>
            <h2>@Model.SectorsCount</h2>
        </div>
    </div>

    <!-- Total Departments -->
    <div class="col-md-3 mb-3">
        <div class="card shadow p-3 text-center" style="border-top:4px solid #005f99">
            <h6>الإدارات</h6>
            <h2>@Model.DepartmentsCount</h2>
        </div>
    </div>

    <!-- Users -->
    <div class="col-md-3 mb-3">
        <div class="card shadow p-3 text-center" style="border-top:4px solid #007acc">
            <h6>المستخدمين</h6>
            <h2>@Model.UsersCount</h2>
        </div>
    </div>

    <!-- Memos -->
    <div class="col-md-3 mb-3">
        <div class="card shadow p-3 text-center" style="border-top:4px solid #00aaff">
            <h6>المذكرات</h6>
            <h2>@Model.MemosCount</h2>
        </div>
    </div>

</div>

<hr />

<div class="row">

    <!-- Pie Chart (Status Distribution) -->
    <div class="col-md-6 mb-3">
        <div class="card shadow p-3">
            <h5 class="text-center">توزيع حالات المذكرات</h5>
            <canvas id="memoPieChart"></canvas>
        </div>
    </div>

    <!-- Bar Chart (Monthly Stats) -->
    <div class="col-md-6 mb-3">
        <div class="card shadow p-3">
            <h5 class="text-center">عدد المذكرات خلال 12 شهر</h5>
            <canvas id="memoBarChart"></canvas>
        </div>
    </div>

</div>

<hr />

<h4 class="mt-4">أحدث 5 مذكرات</h4>

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>العنوان</th>
            <th>من</th>
            <th>إلى</th>
            <th>الحالة</th>
            <th>التاريخ</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var m in Model.LatestMemos)
        {
            <tr>
                <td>@m.Subject</td>
                <td>@m.FromDepartment?.Name</td>
                <td>@m.ToDepartment?.Name</td>
                <td>@m.Status</td>
                <td>@m.CreatedAt.ToString("yyyy/MM/dd")</td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {

    <!-- لو مش ضايف Chart.js في ال Layout حط السكربت ده -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Pie Chart Data
        const pieData = {
            labels: ['جديدة', 'قيد المراجعة', 'معتمدة', 'مرفوضة', 'مغلقة'],
            datasets: [{
                data: [
        @Model.NewMemos,
        @Model.UnderReview,
        @Model.Approved,
        @Model.Rejected,
        @Model.Closed
                ],
                backgroundColor: [
                    '#007acc',  // new
                    '#ffc107',  // under review
                    '#28a745',  // approved
                    '#dc3545',  // rejected
                    '#343a40'   // closed
                ]
            }]
        };

        new Chart(document.getElementById('memoPieChart'), {
            type: 'pie',
            data: pieData
        });

        // Bar Chart (Monthly)
        const months = [];
        const memoCounts = [];

        @foreach (var item in Model.MonthlyStats)
        {
            @:months.push('@item.Month');
            @:memoCounts.push(@item.Count);
        }

        new Chart(document.getElementById('memoBarChart'), {
            type: 'bar',
            data: {
                labels: months,
                datasets: [{
                    label: 'عدد المذكرات',
                    data: memoCounts,
                    backgroundColor: '#005f99'
                }]
            }
        });
    </script>
}
